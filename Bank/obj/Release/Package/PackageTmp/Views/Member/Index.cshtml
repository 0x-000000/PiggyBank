@{
    ViewBag.Title = "Member";
    var username = ViewBag.Username as string ?? "unknown";
    var type = ViewBag.AccountType as string ?? "member";
}

<p>Hello, @username (@type)</p>

@using (Html.BeginForm("Logout", "Account", FormMethod.Post))
{
    <button type="submit">Log Out</button>
}

<div>
    <h3>Deposit</h3>
    <form id="depositForm">
        <p>Amount <input type="number" id="depositAmount" required /></p>
        <p><button type="submit">Send</button></p>
    </form>
    <textarea id="depositResult" readonly></textarea>
</div>

<div>
    <h3>Spend</h3>
    <form id="spendForm">
        <p>Amount <input type="number" id="spendAmount" required /></p>
        <p><button type="submit">Send</button></p>
    </form>
    <textarea id="spendResult" readonly></textarea>
</div>

<div>
    <h3>Balance</h3>
    <form id="balanceForm">
        <p><button type="submit">Refresh My Balance</button></p>
    </form>
    <textarea id="balanceResult" readonly></textarea>
</div>

<div>
    <h3>Transfer</h3>
    <form id="transferForm">
        <p>Send To Username <input type="text" id="transferToUser" required /></p>
        <p>Amount <input type="number" id="transferAmount" required /></p>
        <p><button type="submit">Send</button></p>
    </form>
    <textarea id="transferResult" readonly></textarea>
</div>

@section Scripts {
    <script>
        var apiBase = '@Url.Content("~/api/bank/")';

        function send(endpoint, payload, outputId) {
            var box = document.getElementById(outputId);
            fetch(apiBase + endpoint, {
                method: "POST",
                headers: { "Content-Type": "application/json" },
                body: JSON.stringify(payload)
            })
                .then(function (res) { return res.text(); })
                .then(function (text) { box.value = text; })
                .catch(function (err) { box.value = err.message; });
        }

        document.getElementById("depositForm").addEventListener("submit", function (e) {
            e.preventDefault();
            send("deposit", {
                amount: Number(document.getElementById("depositAmount").value),
                targetUsername: ""
            }, "depositResult");
        });

        document.getElementById("spendForm").addEventListener("submit", function (e) {
            e.preventDefault();
            send("spend", {
                amount: Number(document.getElementById("spendAmount").value),
                targetUsername: ""
            }, "spendResult");
        });

        document.getElementById("balanceForm").addEventListener("submit", function (e) {
            e.preventDefault();
            send("balance", {
                targetUsername: ""
            }, "balanceResult");
        });

        document.getElementById("transferForm").addEventListener("submit", function (e) {
            e.preventDefault();
            send("transfer", {
                fromUsername: "",
                toUsername: document.getElementById("transferToUser").value,
                amount: Number(document.getElementById("transferAmount").value)
            }, "transferResult");
        });
    </script>
}
